<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Services\FirebaseNotificationService;

class SendMotivationalQuote extends Command
{
    protected $signature = 'send:motivation';
    protected $description = 'Send a random motivational quote every three hours';

    protected $quotes;

    public function __construct()
    {
        parent::__construct();
        $this->quotes = [
    "القراءة هي مفتاح المعرفة، ومعرفة هي مفتاح النجاح.",
    "الكتاب هو صديقك الذي لا يخونك أبداً.",
    "كلما قرأت أكثر، كلما عرفت أكثر. وكلما عرفت أكثر، كلما كنت أكثر نجاحاً.",
    "الكتب هي طائرات، وقطارات، وسكك حديدية. هي الوجهات.",
    "من خلال القراءة، يمكنك السفر إلى أماكن لم تزورها أبداً.",
    "القراءة هي جواز سفر إلى عوالم جديدة.",
    "عندما تقرأ، أنت تعيش تجارب الآخرين، وتتعلم من نجاحاتهم وإخفاقاتهم.",
    "الكتب لا تتحدث، لكنها تنقل إلينا حكمة العصور.",
    "الشخص الذي لا يقرأ ليس لديه ميزة على الشخص الذي لا يعرف القراءة.",
    "تذكر أن القراءة تمنحك حياة ثانية، حياة مليئة بالإلهام والمعرفة.",
    "كل كتاب هو عالم جديد بانتظار من يكتشفه.",
    "عندما تقرأ، تزرع بذور النجاح في عقلك.",
    "القراءة ليست مجرد هواية، بل هي مفتاح مستقبل مشرق.",
    "لا يوجد شيء أفضل من قراءة كتاب لتوسيع آفاقك.",
    "الكتاب هو معلم صامت يفتح لك أبواب الحكمة.",
    "اقرأ لتتعلم، وابتكر لتعيش.",
    "القراءة غذاء العقل.",
    "مع كل صفحة تقرأها، تفتح باباً جديداً من المعرفة.",
    "الأفكار العظيمة تأتي من عقول مثقفة.",
    "كل كتاب هو نافذة إلى عوالم جديدة.",
    "العلم لا حدود له، وكلما قرأت، زادت حدودك.",
    "اقرأ، فالعلم نور.",
    "اجعل الكتاب صديقك في كل الأوقات.",
    "الكتب تزرع فينا حب الاستكشاف.",
    "عندما تقرأ، تشعر أنك تسافر عبر الزمن.",
    "العقل المثقف هو أفضل سلاح في مواجهة التحديات.",
    "القراءة تفتح لك أبواب الحكمة.",
    "الكتاب هو جسر إلى المعرفة.",
    "بالقراءة، تتعلم كيف تفكر.",
    "المعرفة تأتي من القراءة، والقراءة تأتي من الشغف.",
    "كل كلمة تقرأها تضيف إلى رصيدك المعرفي.",
    "عندما تقرأ، تحرر خيالك.",
    "عش حياتك كأنك في قصة، وابدأ بقراءة الكتاب.",
    "الكتب تمنحك القدرة على فهم العالم من حولك.",
    "اجعل القراءة عادة يومية.",
    "الكتاب هو الطريق نحو التغيير.",
    "اقرأ في كل مجال، وكن شخصاً متعدد المعرفة.",
    "كل قراءة تعني فرصة جديدة للتعلم.",
    "المكتبة هي كنز لا يُقدر بثمن.",
    "من خلال القراءة، نبني مستقبلنا.",
    "التعليم هو ما تبقى فيك عندما ينسى الجميع ما تعلمته.",
    "التفكير هو أساس المعرفة، والقراءة هي أساس التفكير.",
    "القراءة تمنحك الفرصة لتكون شخصاً أفضل.",
    "بقراءة الكتب، نعيش تجارب الآخرين.",
    "القراءة هي أداة النجاح.",
    "الكتب تحوي سرّ الحياة.",
    "تعلم كيف تفكر بشكل نقدي من خلال القراءة.",
    "الكتاب هو صديقك في الأوقات الصعبة.",
    "تخيل ما يمكنك تحقيقه، ثم ابدأ بالقراءة.",
    "عندما تقرأ، أنت تفتح عقلك على العالم.",
    "كن فضولياً، واقرأ ما يجذب اهتمامك.",
    "اقرأ لتكتشف نفسك.",
    "القراءة تمنحك صوتاً في العالم.",
    "كل قراءة هي خطوة نحو التقدم.",
    "العالم مليء بالقصص، والقراءة تجلبها إليك.",
    "اجعل القراءة جزءاً من روتينك اليومي.",
    "الكتب تعطيك أفكاراً جديدة.",
    "كل كتاب هو رفيق في رحلتك.",
    "المعرفة تُبنى على القراءة.",
    "كلما قرأت، كلما ازدادت خبرتك.",
    "اقرأ عن أحلامك، وتعلم كيف تحققها.",
    "التعلم من الكتب هو أساس النجاح.",
    "اقرأ في كل مجال، وتوسيع آفاقك.",
    "كل كتاب هو فرصة للتعلم.",
    "عندما تقرأ، تعيش آلاف التجارب.",
    "الكتب تمنحك قدرة على التفكير العميق.",
    "عندما تتعلم، تتغير نظرتك للعالم.",
    "اجعل القراءة متعتك.",
    "تذكر أن القراءة تمنحك القوة.",
    "العلم والمعرفة هما الطريق إلى المستقبل.",
    "بالقراءة، تجد الإجابات على تساؤلاتك.",
    "كل كتاب يفتح لك أفقاً جديداً.",
    "القراءة تمنحك القدرة على الابتكار.",
    "تأمل في ما تقرأ، وابحث عن المعاني.",
    "الكتب تعطيك أجنحة للطيران.",
    "عش كل لحظة وكأنها صفحة جديدة في كتابك.",
    "اقرأ لتتعلم، وتعلم لتُحدث فرقاً.",
    "الكتب تحوي عوالم لا حدود لها.",
    "اجعل القراءة شغفك اليومي.",
    "كل قراءة تجعل منك إنساناً أفضل.",
    "اقرأ، فأنت تستحق المعرفة.",
    "العلم هو كنز، والقراءة هي مفتاحه."
];

    }

    public function handle()
    {
        $randomQuote = $this->quotes[array_rand($this->quotes)];
        $firebaseService = app(FirebaseNotificationService::class);

        $reslut = $firebaseService->sendToAll( [
            "type" => null,
            "title" => 'يلا امتحان',
            "body" => $randomQuote,
        ]);
        
        $this->logMessage('reslut: '.$reslut['success'].' and the message: '.$randomQuote);
        
        $this->info('Motivational quote sent: ' . $randomQuote);
    }
    
    
    function logMessage($message) {
    // Get the current date and time for the filename
    $date = date('Y-m-d');
    $filename = storage_path("logs/yalla_emtihan_message_log_$date.txt");

    // Create the log directory if it doesn't exist
    if (!file_exists(storage_path('logs'))) {
        if (!mkdir(storage_path('logs'), 0755, true) && !is_dir(storage_path('logs'))) {
            throw new \RuntimeException(sprintf('Directory "%s" was not created', storage_path('logs')));
        }
    }

    // Prepare the log entry
    $timestamp = date('Y-m-d H:i:s');
    $logEntry = "[$timestamp] $message\n";

    // Write the log entry to the file
    if (file_put_contents($filename, $logEntry, FILE_APPEND) === false) {
        throw new \RuntimeException(sprintf('Unable to write to file "%s"', $filename));
    }
}

}
